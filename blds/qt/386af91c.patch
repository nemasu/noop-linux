From 386af91c57948b88ba98cb040430e4a3878e3e3b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bernhard=20Rosenkr=C3=A4nzer?= <bero@linaro.org>
Date: Fri, 30 Jun 2017 17:39:01 +0200
Subject: [PATCH] Fix detection of AT-SPI
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Building qtbase 5.9.1 on Linux always results in a build with
accessibility support disabled.

The problem is that the config option for accessibility-atspi-bridge
checks for config.atspi, which isn't defined anywhere - it should
check for libs.atspi (which is set if pkg-config finds atspi-2) instead.

[ChangeLog][QtGui][Platform Specific Changes][Linux/XCB]
Fixed detection of AT-SPI, allowing accessibility support to be built
again.

Task-number: QTBUG-61731
Change-Id: If3bd5dfccda40158c566f8507e34b6877b59b6fb
Reviewed-by: Frederik Gladhorn <frederik.gladhorn@qt.io>
Reviewed-by: Bernhard Rosenkr√§nzer <bero@lindev.ch>
---
 src/gui/configure.json | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/gui/configure.json b/src/gui/configure.json
index a2a78aa071..ef7ba51c38 100644
--- a/qtbase/src/gui/configure.json
+++ b/qtbase/src/gui/configure.json
@@ -434,7 +434,7 @@
     "features": {
         "accessibility-atspi-bridge": {
             "label": "ATSPI Bridge",
-            "condition": "features.accessibility && features.xcb && features.dbus && config.atspi",
+            "condition": "features.accessibility && features.xcb && features.dbus && libs.atspi",
             "output": [ "privateFeature", "feature" ]
         },
         "angle": {
